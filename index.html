<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEVEL 2⁵</title>
    
    <!-- FAVICON EXPLÍCITO -->
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Metaetiquetas para compartir en WhatsApp (Open Graph) -->
    <meta property="og:title" content="LEVEL 2⁵ - La Fiesta">
    <meta property="og:description" content="Cuenta atrás, ubicación, calendario de adviento y RSVP. ¡No faltes!">
    
    <!-- TRUCO: Usamos un nombre nuevo 'invitacion.jpg' para forzar a WhatsApp a recargar -->
    <meta property="og:image" content="https://op-level32.netlify.app/invitacion.jpg">
    <meta property="og:image:secure_url" content="https://op-level32.netlify.app/invitacion.jpg">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://op-level32.netlify.app/">
    
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tipografía -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- Librería Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    
    <style>
        /* --- ESTILOS DE EMERGENCIA (FALLBACK) --- */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0f172a; 
            color: #e2e8f0; 
            margin: 0;
            line-height: 1.5;
        }
        svg { 
            max-width: 24px; 
            max-height: 24px; 
            vertical-align: middle;
            display: inline-block;
        }
        .max-w-2xl { 
            max-width: 42rem; 
            margin-left: auto; 
            margin-right: auto; 
        }
        a { color: inherit; text-decoration: none; }
        /* --- FIN ESTILOS EMERGENCIA --- */

        body { scroll-behavior: smooth; }
        .iframe-container {
            position: relative;
            overflow: hidden;
            width: 100%;
            padding-top: 150%;
        }
        .iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 py-12 px-4 md:px-8">

    <div class="max-w-2xl mx-auto">

        <!-- Título principal -->
        <h1 class="text-5xl md:text-6xl font-black text-center mb-10 relative select-none">
            <span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-500" style="background-image: linear-gradient(to right, #fbbf24, #f97316); -webkit-background-clip: text; color: transparent;">
                LEVEL 2
            </span>
            <span class="absolute text-2xl font-black ml-1 -top-2 text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-500" style="background-image: linear-gradient(to right, #fbbf24, #f97316); -webkit-background-clip: text; color: transparent;">
                5
            </span>
        </h1>

        <!-- CAJA 1: INTRODUCCIÓN -->
        <div class="bg-slate-800 rounded-2xl p-6 mb-6 shadow-lg border border-slate-700">
            <h2 class="text-3xl font-bold text-amber-400 mb-3" style="color: #fbbf24;">¡Lo primero!</h2>
            <p class="text-slate-300 text-lg leading-relaxed mb-5">
                Sean bienvenidos, no olviden firmar por aquí al menos una vez (y no <i>muchas</i> a ser posible :D)
            </p>
            <a href="#rsvp-section" class="block w-full text-center bg-amber-500 text-slate-900 font-bold py-3 px-5 rounded-lg transition-transform duration-200 hover:scale-105 hover:shadow-lg hover:shadow-amber-500/20" style="background-color: #f59e0b; color: #0f172a; display: block; padding: 12px; border-radius: 8px; text-align: center; font-weight: bold;">
                RSVP (también lo tienes ahí abajo)
            </a>
        </div>

        <!-- CAJA 2: UBICACIÓN Y CUENTA ATRÁS -->
        <div class="bg-slate-800 rounded-2xl p-6 mb-6 shadow-lg border border-slate-700">
            <h2 class="text-3xl font-bold text-amber-400 mb-3" style="color: #fbbf24;">¡Lo importante!</h2>
            
            <p class="text-2xl font-bold mb-4">Tortillas Etiqueta Negra (Plaza de Castilla)</p>
            <a href="https://maps.app.goo.gl/PmrxDBLrWScP9SPP6" target="_blank" rel="noopener noreferrer" class="block w-full text-center bg-blue-600 text-white font-bold py-3 px-5 rounded-lg transition-transform duration-200 hover:scale-105 hover:shadow-lg hover:shadow-blue-500/20" style="background-color: #2563eb; color: white; display: block; padding: 12px; border-radius: 8px; text-align: center; font-weight: bold;">
                Ver en Google Maps
            </a>

            <div class="mt-6 pt-6 border-t border-slate-700">
                <p class="text-lg font-semibold text-center text-slate-300 mb-4">
                    Sábado 27 de diciembre, 19:00h
                </p>
                <div id="countdown" class="flex justify-around text-center" style="display: flex; justify-content: space-around; text-align: center;">
                    <div>
                        <div id="days" class="text-4xl md:text-5xl font-black tabular-nums">00</div>
                        <div class="text-xs text-slate-400 uppercase tracking-wider">Días</div>
                    </div>
                    <div>
                        <div id="hours" class="text-4xl md:text-5xl font-black tabular-nums">00</div>
                        <div class="text-xs text-slate-400 uppercase tracking-wider">Horas</div>
                    </div>
                    <div>
                        <div id="minutes" class="text-4xl md:text-5xl font-black tabular-nums">00</div>
                        <div class="text-xs text-slate-400 uppercase tracking-wider">Minutos</div>
                    </div>
                    <div>
                        <div id="seconds" class="text-4xl md:text-5xl font-black tabular-nums">00</div>
                        <div class="text-xs text-slate-400 uppercase tracking-wider">Segundos</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CAJA 3: SECCIÓN DINÁMICA -->
        <div id="daily-content" class="bg-slate-800 rounded-2xl p-6 mb-6 shadow-lg border border-slate-700 hidden fade-in">
            <!-- Cabecera -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <h2 class="text-3xl font-bold text-amber-400" style="color: #fbbf24;">¡Lo otro!</h2>
                <a href="calendario.html" class="inline-flex items-center bg-amber-500/10 text-amber-400 border border-amber-500/50 px-4 py-2 rounded-full text-sm font-bold hover:bg-amber-500 hover:text-slate-900 transition-all duration-300 group shadow-lg shadow-amber-500/10 hover:scale-105" style="border: 1px solid rgba(245, 158, 11, 0.5); color: #fbbf24; padding: 8px 16px; border-radius: 9999px; display: inline-flex; align-items: center;">
                    <svg class="w-4 h-4 mr-2 transition-transform group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2zm-7 5h5v5h-5v-5z"></path></svg>
                    (CALENDARIO DE ADVIENTO)
                </a>
            </div>
            
            <!-- TÍTULO DEL DÍA (OCULTO TEMPORALMENTE) -->
            <!-- 
            <div id="titulo-dia-container" class="mb-4 hidden">
                <h3 id="titulo-dia-text" class="text-xl font-bold text-white text-center uppercase tracking-wide" style="letter-spacing: 0.05em;"></h3>
            </div>
            -->

            <!-- Cita -->
            <div id="cita-container" class="mb-6 hidden">
                <p class="text-2xl italic font-semibold text-slate-500/50 font-serif leading-none">"</p>
                <p id="cita-text" class="text-xl md:text-2xl italic font-medium text-center px-4 text-slate-200"></p>
                <p class="text-2xl italic font-semibold text-slate-500/50 text-right font-serif leading-none">"</p>
            </div>
            
            <!-- Botones -->
            <div id="links-container" class="space-y-3">
                <a id="temardo-link" href="#" target="_blank" rel="noopener noreferrer" class="hidden flex items-center bg-green-600 text-white font-bold py-3 px-5 rounded-lg transition-all duration-200 hover:scale-105 group" style="background-color: #16a34a; color: white; padding: 12px; border-radius: 8px; display: flex; align-items: center; margin-bottom: 10px;">
                    <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m4.238 14.026c-.208.328-.618.438-.945.23-.74-.477-2.903-1.78-4.943-1.78-1.91 0-4.043 1.22-4.743 1.69-.328.208-.738.1-.945-.23-.208-.328-.1-.738.23-.945C6.03 13.68 8.09 12.5 10.5 12.5c2.28 0 4.608 1.09 5.683 1.81.327.208.437.618.23.945M12 4.004c4.411 0 8 3.589 8 8 0 1.902-.66 3.634-1.75 5.032-.204.26-.58.34-.84.135-.82-.64-3.568-2.82-6.41-2.82-2.97 0-5.77 2.29-6.41 2.82-.26.204-.636.126-.84-.135C4.66 15.638 4 13.906 4 12c0-4.411 3.589-7.996 8-7.996m0 1.996c-3.309 0-6 2.691-6 6 0 1.48.54 2.823 1.447 3.864.12.14.33.17.48.06.66-.5 3.03-2.4 5.07-2.4s4.41 1.9 5.07 2.4c.15.11.36.08.48-.06C19.46 14.823 20 13.48 20 12c0-3.309-2.691-6-6-6"></path></svg>
                    Temardo
                </a>
                <a id="memardo-link" href="#" target="_blank" rel="noopener noreferrer" class="hidden flex items-center bg-pink-600 text-white font-bold py-3 px-5 rounded-lg transition-all duration-200 hover:scale-105 group" style="background-color: #db2777; color: white; padding: 12px; border-radius: 8px; display: flex; align-items: center; margin-bottom: 10px;">
                    <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m-2.5-4.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5-1.5m5 0c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5-1.5M12 6c-2.36 0-4.4 1.53-5.18 3.65l1.91.7C9.25 9.07 10.51 8 12 8s2.75 1.07 3.27 2.35l1.91-.7C16.4 7.53 14.36 6 12 6"></path></svg>
                    Memardo
                </a>
                <a id="podcardo-link" href="#" target="_blank" rel="noopener noreferrer" class="hidden flex items-center bg-indigo-600 text-white font-bold py-3 px-5 rounded-lg transition-all duration-200 hover:scale-105" style="background-color: #4f46e5; color: white; padding: 12px; border-radius: 8px; display: flex; align-items: center; margin-bottom: 10px;">
                    <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3zM11 14.05V18h-3v2h8v-2h-3v-3.95A5.002 5.002 0 0 1 17 10v-1h-2v1a3 3 0 0 0-6 0v-1H7v1a5.002 5.002 0 0 1 4 4.05z"></path></svg>
                    Podcardo
                </a>
                <a id="tvardo-link" href="#" target="_blank" rel="noopener noreferrer" class="hidden flex items-center bg-red-600 text-white font-bold py-3 px-5 rounded-lg transition-all duration-200 hover:scale-105" style="background-color: #dc2626; color: white; padding: 12px; border-radius: 8px; display: flex; align-items: center; margin-bottom: 10px;">
                    <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"></path></svg>
                    TVardo
                </a>
                <a id="extra-link" href="#" target="_blank" rel="noopener noreferrer" class="hidden flex items-center bg-amber-500 text-slate-900 font-bold py-3 px-5 rounded-lg transition-all duration-200 hover:scale-105" style="background-color: #f59e0b; color: #0f172a; padding: 12px; border-radius: 8px; display: flex; align-items: center; margin-bottom: 10px;">
                    <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24"><path d="M17 7h-4v2h4c1.65 0 3 1.35 3 3s-1.35 3-3 3h-4v2h4c2.76 0 5-2.24 5-5s-2.24-5-5-5zm-6 8H7c-1.65 0-3-1.35-3-3s1.35-3 3-3h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-2zm-3-4h8v2H8v-2z"></path></svg>
                    <span>Extra</span>
                </a>
            </div>

            <div id="default-message" class="py-4 hidden">
                <p class="text-slate-400 text-center italic">Buscando en los archivos...</p>
            </div>
        </div>

        <!-- CAJA 4: RSVP -->
        <div id="rsvp-section" class="bg-slate-800 rounded-2xl p-6 mb-6 shadow-lg border border-slate-700">
            <h2 class="text-3xl font-bold text-amber-400 mb-6" style="color: #fbbf24;">RSVP - Confirmar Asistencia</h2>
            <div class="iframe-container rounded-lg overflow-hidden bg-white">
                <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSeyeMGHOU3OCPhiOpmWhqsJYU_Yj_nS4gEfOrsymfRp5AmsFQ/viewform?embedded=true" frameborder="0" marginheight="0" marginwidth="0">Cargando…</iframe>
            </div>
        </div>

        <footer class="text-center mt-12 mb-6">
            <p class="text-slate-500 text-sm">Un pequeño experimento web para un gran cumpleaños.</p>
            <p class="text-slate-600 text-xs mt-2">LEVEL 2⁵ &copy; 2025</p>
        </footer>

    </div>

    <!-- SCRIPTS -->
    <script>
        // 1. CUENTA ATRÁS
        const countdownDiv = document.getElementById('countdown');
        const eventoFecha = new Date("2025-12-27T19:00:00"); 

        function updateCountdown() {
            const ahora = new Date();
            const diff = eventoFecha - ahora;
            if (diff <= 0) {
                countdownDiv.innerHTML = "<div class='text-2xl font-bold text-amber-400 text-center w-full animate-pulse'>¡LA FIESTA HA COMENZADO!</div>";
                clearInterval(countdownInterval);
                return;
            }
            const d = Math.floor(diff / (1000 * 60 * 60 * 24));
            const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);
            document.getElementById('days').innerText = d.toString().padStart(2, '0');
            document.getElementById('hours').innerText = h.toString().padStart(2, '0');
            document.getElementById('minutes').innerText = m.toString().padStart(2, '0');
            document.getElementById('seconds').innerText = s.toString().padStart(2, '0');
        }
        const countdownInterval = setInterval(updateCountdown, 1000);
        updateCountdown(); 

        // 2. CONTENIDO DIARIO
        const URL_HOJA_CALCULO = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRO6dL6ivJT72hUEfMGtxhOmM02vb_Z31TvGY1WD7mrBDQIBH9b4Ni35bi8iUNEuO3mRFYM8l_8YI0I/pub?gid=0&single=true&output=csv";

        const dailyContentEl = document.getElementById('daily-content');
        const defaultMessage = document.getElementById('default-message');
        const citaContainer = document.getElementById('cita-container');
        const citaText = document.getElementById('cita-text');
        // Referencias al título (ocultas pero listas)
        const tituloDiaContainer = document.getElementById('titulo-dia-container');
        const tituloDiaText = document.getElementById('titulo-dia-text');
        const botones = {
            'Temardo': document.getElementById('temardo-link'),
            'Memardo': document.getElementById('memardo-link'),
            'Podcardo': document.getElementById('podcardo-link'),
            'TVardo': document.getElementById('tvardo-link'),
            'Extralink': document.getElementById('extra-link')
        };

        function getHoy() {
            const now = new Date();
            const options = { timeZone: 'Europe/Madrid', hour: '2-digit', hour12: false };
            const timeFormatter = new Intl.DateTimeFormat('en-US', options);
            const currentHourInMadrid = parseInt(timeFormatter.format(now), 10);
            const dateToUse = new Date();
            if (currentHourInMadrid < 3) dateToUse.setDate(dateToUse.getDate() - 1);
            const dd = String(dateToUse.getDate()).padStart(2, '0');
            const mm = String(dateToUse.getMonth() + 1).padStart(2, '0'); 
            const yy = String(dateToUse.getFullYear()).slice(-2);
            return `${dd}/${mm}/${yy}`;
        }

        function cargarContenidoDiario() {
            const fechaHoy = getHoy();
            Papa.parse(URL_HOJA_CALCULO, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    const datos = results.data;
                    const indiceHoy = datos.findIndex(fila => fila.Fecha === fechaHoy);

                    if (indiceHoy > -1) { 
                        let contenidoEncontrado = false;
                        const getValorReciente = (columna) => {
                            for (let i = indiceHoy; i >= 0; i--) {
                                if (datos[i] && datos[i][columna] && datos[i][columna].trim() !== "") return datos[i][columna];
                            }
                            return null;
                        };

                        // Título del día (COMENTADO TEMPORALMENTE)
                        /*
                        const titulo = getValorReciente('Titulo');
                        if (titulo) {
                            tituloDiaText.innerText = titulo;
                            tituloDiaContainer.classList.remove('hidden');
                        }
                        */

                        const cita = getValorReciente('Cita');
                        if (cita) {
                            citaText.innerText = cita;
                            citaContainer.classList.remove('hidden');
                            contenidoEncontrado = true;
                        }

                        ['Temardo', 'Memardo', 'Podcardo', 'TVardo'].forEach(tipo => {
                            const valor = getValorReciente(tipo);
                            if (valor) {
                                botones[tipo].href = valor;
                                botones[tipo].classList.remove('hidden');
                                contenidoEncontrado = true;
                            }
                        });

                        const extralink = getValorReciente('Extralink');
                        const extratexto = getValorReciente('Extratexto');
                        if (extralink) {
                            botones['Extralink'].href = extralink;
                            const texto = (extratexto && extratexto.trim() !== "") ? extratexto : 'Extra';
                            botones['Extralink'].querySelector('span').innerText = texto;
                            botones['Extralink'].classList.remove('hidden');
                            contenidoEncontrado = true;
                        }

                        dailyContentEl.classList.remove('hidden');
                        if (!contenidoEncontrado) {
                            defaultMessage.innerText = "Hoy no hay contenido nuevo... ¡pero mira el calendario!";
                            defaultMessage.classList.remove('hidden');
                        }
                    } else {
                        dailyContentEl.classList.remove('hidden');
                        defaultMessage.innerText = "La cuenta atrás sigue en marcha... ¡vuelve pronto!";
                        defaultMessage.classList.remove('hidden');
                    }
                },
                error: function(err) {
                    console.error("Error CSV:", err);
                    dailyContentEl.classList.remove('hidden');
                    defaultMessage.innerText = "Error cargando los datos. Prueba a recargar.";
                    defaultMessage.classList.remove('hidden');
                }
            });
        }
        cargarContenidoDiario();
    </script>
</body>
</html>